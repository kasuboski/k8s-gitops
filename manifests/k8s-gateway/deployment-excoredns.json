{
  "apiVersion": "apps/v1",
  "kind": "Deployment",
  "metadata": {
    "labels": {
      "k8s.joshcorp.co/app": "k8s-gateway"
    },
    "name": "excoredns"
  },
  "spec": {
    "replicas": 1,
    "selector": {
      "matchLabels": {
        "k8s-app": "excoredns"
      }
    },
    "template": {
      "metadata": {
        "labels": {
          "k8s-app": "excoredns"
        }
      },
      "spec": {
        "containers": [
          {
            "args": [
              "-conf",
              "/etc/coredns/Corefile"
            ],
            "image": "quay.io/oriedge/k8s_gateway",
            "imagePullPolicy": "IfNotPresent",
            "name": "coredns",
            "ports": [
              {
                "containerPort": 1053,
                "name": "udp-1053",
                "protocol": "UDP"
              },
              {
                "containerPort": 1053,
                "name": "tcp-1053",
                "protocol": "TCP"
              },
              {
                "containerPort": 8181,
                "name": "http-8181",
                "protocol": "HTTP"
              }
            ],
            "readinessProbe": {
              "httpGet": {
                "path": "/ready",
                "port": 8181
              }
            },
            "resources": {
              "limits": {
                "cpu": "100m",
                "memory": "128Mi"
              },
              "requests": {
                "cpu": "100m",
                "memory": "128Mi"
              }
            },
            "securityContext": {
              "allowPrivilegeEscalation": false,
              "capabilities": {
                "drop": [
                  "All"
                ]
              },
              "runAsNonRoot": true,
              "runAsUser": 1000,
              "seccompProfile": {
                "type": "RuntimeDefault"
              }
            },
            "volumeMounts": [
              {
                "mountPath": "/etc/coredns",
                "name": "config-volume"
              }
            ]
          }
        ],
        "dnsPolicy": "ClusterFirst",
        "serviceAccountName": "excoredns",
        "volumes": [
          {
            "configMap": {
              "items": [
                {
                  "key": "Corefile",
                  "path": "Corefile"
                }
              ],
              "name": "excoredns"
            },
            "name": "config-volume"
          }
        ]
      }
    }
  }
}
