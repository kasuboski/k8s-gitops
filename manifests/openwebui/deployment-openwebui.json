{
  "apiVersion": "apps/v1",
  "kind": "Deployment",
  "metadata": {
    "labels": {
      "k8s.joshcorp.co/app": "openwebui"
    },
    "name": "openwebui"
  },
  "spec": {
    "selector": {
      "matchLabels": {
        "app.kubernetes.io/name": "openwebui"
      }
    },
    "strategy": {
      "type": "Recreate"
    },
    "template": {
      "metadata": {
        "labels": {
          "app": "openwebui",
          "app.kubernetes.io/name": "openwebui"
        }
      },
      "spec": {
        "containers": [
          {
            "env": [
              {
                "name": "OLLAMA_BASE_URL",
                "value": "https://ollama.joshcorp.co"
              },
              {
                "name": "ENABLE_OAUTH_SIGNUP",
                "value": "true"
              },
              {
                "name": "OAUTH_CLIENT_ID",
                "value": "d8654a7c-e2b1-4308-b2d7-7c99d9e9401f"
              },
              {
                "name": "OAUTH_PROVIDER_NAME",
                "value": "Pocket ID"
              },
              {
                "name": "OPENID_PROVIDER_URL",
                "value": "https://pocket-id.joshcorp.co/.well-known/openid-configuration"
              },
              {
                "name": "OAUTH_MERGE_ACCOUNTS_BY_EMAIL",
                "value": "true"
              },
              {
                "name": "ENABLE_OAUTH_ROLE_MANAGEMENT",
                "value": "true"
              },
              {
                "name": "ENABLE_OAUTH_GROUP_MANAGEMENT",
                "value": "true"
              },
              {
                "name": "ENABLE_OAUTH_GROUP_CREATION",
                "value": "true"
              },
              {
                "name": "OAUTH_ALLOWED_ROLES",
                "value": "users, admins"
              },
              {
                "name": "OAUTH_ADMIN_ROLES",
                "value": "admins"
              },
              {
                "name": "OAUTH_ROLES_CLAIM",
                "value": "groups"
              },
              {
                "name": "OAUTH_SCOPES",
                "value": "openid email profile groups"
              },
              {
                "name": "DEFAULT_USER_ROLE",
                "value": "user"
              },
              {
                "name": "ENABLE_LOGIN_FORM",
                "value": "true"
              },
              {
                "name": "OAUTH_UPDATE_PICTURE_ON_LOGIN",
                "value": "true"
              }
            ],
            "envFrom": [
              {
                "secretRef": {
                  "name": "openwebui"
                }
              }
            ],
            "image": "ghcr.io/open-webui/open-webui:v0.6.41",
            "name": "openwebui",
            "ports": [
              {
                "containerPort": 8080,
                "name": "http"
              }
            ],
            "resources": {
              "limits": {
                "cpu": "4000m",
                "memory": "4Gi"
              },
              "requests": {
                "cpu": "1000m"
              }
            },
            "securityContext": {
              "allowPrivilegeEscalation": false,
              "capabilities": {
                "drop": [
                  "All"
                ]
              },
              "runAsNonRoot": true,
              "runAsUser": 1000,
              "seccompProfile": {
                "type": "RuntimeDefault"
              }
            },
            "volumeMounts": [
              {
                "mountPath": "/app/backend/data",
                "name": "openwebui"
              }
            ]
          }
        ],
        "securityContext": {
          "fsGroup": 1000
        },
        "volumes": [
          {
            "name": "openwebui",
            "persistentVolumeClaim": {
              "claimName": "openwebui"
            }
          }
        ]
      }
    }
  }
}
